## 176. Second Highest Salary

### SQL schema
```mysql
Create table If Not Exists Employee (Id int, Salary int)
Truncate table Employee
insert into Employee (Id, Salary) values ('1', '100')
insert into Employee (Id, Salary) values ('2', '200')
insert into Employee (Id, Salary) values ('3', '300')
```

```
Write a SQL query to get the second highest salary from the Employee table.

+----+--------+
| Id | Salary |
+----+--------+
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |
+----+--------+
For example, given the above Employee table, the query should return 200 as the second highest salary. 
If there is no second highest salary, then the query should return null.

+---------------------+
| SecondHighestSalary |
+---------------------+
| 200                 |
+---------------------+
```

### mycode
#### failed 1
* run succeed, test failed
* can't deal with the 'one record returns null' problem
* rank the salary and select the rank number=2 entry
```mysql
select salary as SecondHighestSalary 
from 
(select 
    Id, salary,
    rank() over (order by Salary) as rank_salary
 from Employee ) as rankedEmp
 where rank_salary=2
```

#### failed 2
* then I came the idea of using **case when** to add null when one record situation happens
* but this returns 0
```mysql
select 
case when (count(*)>1 )
     then null
     else salary
     end as SecondHighestSalary

from 
(select id, salary,
rank() over (order by salary desc) as rank_salary 
from Employee) as ranked_table

where rank_salary  =2
```

#### succeed 3
* then I came with the idea **if(expr, no, yes)**
```mysql
select if(count(salary)>1, null,salary) as SecondHighestSalary
from 
(select id, salary,
rank() over (order by salary desc) as rank_salary 
from Employee) as ranked_table

where rank_salary  =2 
```

### Return NULL value when MySQL returned an empty result set 1
* You can Encapsulate the query with the Outer select, if you want NULL from the database in case of 0 rows,
```mysql
SELECT 
    (
      SELECT a.ab 
      FROM 
          tab a INNER JOIN tab b 
           ON a.ab=b.ab
    ) As New;
  ```
#### failed 4
*  limit 1,1 
* failed to get null & fail to recognise multiple entries in same salary 
```mysql
select salary from employee 
order by salary desc
limit 1,1
```
#### failed 5
* limit 1,1 + distinct (to solve same salary issue)
* fail to solve null issue
```mysql
select distinct salary as SecondHighestSalary 
from employee
order by salary desc
limit 1,1
```

#### others
* 
```mysql
select 
(select distinct salary from employee
order by salary desc
limit 1,1 )as SecondHighestSalary
```
#### others
```mysql
SELECT IF (COUNT(Salary) > 0, Salary, NULL) AS SecondHighestSalary
FROM (
    SELECT DISTINCT Salary
    FROM Employee
    ORDER BY Salary DESC
    LIMIT 1 OFFSET 1
) AS T
```

### Return NULL value when MySQL returned an empty result set 2
You can use the alternative with **UNION ALL*** and **LIMIT**
```mysql
      SELECT a.ab 
      FROM 
          table a INNER JOIN table b 
           ON a.ab=b.ab
      UNION ALL 
      SELECT NULL
      LIMIT 1
```
#### succeed  
* union 18%
```mysql
select salary as SecondHighestSalary from employee 

union (select null as SecondHighestSalary )

order by SecondHighestSalary  desc

limit 1,1
```

#### other's
* manually add one **null** in the begining
* **union all** merge 2 table together(include duplicate records)+ **order by+ limit+ offset** 
```mysql
SELECT DISTINCT Salary AS SecondHighestSalary 
FROM Employee 
UNION ALL (SELECT null AS Salary)
order by SecondHighestSalary desc
limit 1 offset 1
```

###  **union** and **union all** difference
* UNION removes duplicate rows.
* UNION ALL does not remove duplicate rows.

#### otherâ€˜s
* use **where** 
```mysql
SELECT max(Salary) AS SecondHighestSalary
FROM Employee
WHERE Salary < (SELECT max(Salary) FROM Employee)
```




